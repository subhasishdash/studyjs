var canvas=document.getElementById("canvas"),dicomFile=document.getElementById("dicomfile");dicomFile.onchange=function(e){var a=e.target||window.event.srcElement,t=a.files;if(FileReader&&t&&t.length){var n=new FileReader,i=t[0].name.split(".").pop().toLowerCase();if("dcm"!==i)return void alert("please choose a Dicom file");n.onload=function(e){console.debug("Loaded the dicom file");var a=new Uint8Array(e.target.result),t=dicomParser.parseDicom(a),n=t.uint16("x00280011"),i=t.uint16("x00280010"),r=t.elements.x7fe00010,o=new Uint8Array(t.byteArray.buffer,r.dataOffset,r.length);canvas.width=n,canvas.height=i;for(var d=canvas.getContext("2d"),l=d.getImageData(0,0,n,i),c=l.data,s=3,f=0;s<c.byteLength;s+=4,f+=2){var m=(255&o[f+1])<<8|255&o[f];c[s]=255-m}d.putImageData(l,0,0),canvas.style.display="block"},n.readAsArrayBuffer(this.files[0])}};